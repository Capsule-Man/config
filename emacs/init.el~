;; Emacs directory
(when load-file-name
  (setq user-emacs-directory (file-name-directory load-file-name)))
;; Directory for custom module 
(add-to-list 'load-path "~/.emacs.d/custom")
;; Not Backup
(setq make-backup-files t) 
;; Package management
(require 'package)
(add-to-list 'package-archives
             '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)
;; Load theme
(load-theme 'wombat t)
;;(load-theme 'tsdh-dark t)
;;(load-theme 'tango-dark t)
;;(load-theme 'wheatgrass t)
;;(load-theme 'misterioso t)

(defun package-install-with-refresh (package)
  (unless (assq package package-alist)
    (package-refresh-contents))
  (unless (package-installed-p package)
    (package-install package)))

;; Install package
;; operation
(package-install-with-refresh 'evil)
(package-install-with-refresh 'helm)
(package-install-with-refresh 'neotree)
(package-install-with-refresh 'ripgrep)
(package-install-with-refresh 'helm-ag)
(package-install-with-refresh 'helm-gtags)
(package-install-with-refresh 'helm-git-grep)
(package-install-with-refresh 'ace-jump-mode)
(package-install-with-refresh 'auto-complete)
(package-install-with-refresh 'company)
(package-install-with-refresh 'restart-emacs)
(package-install-with-refresh 'smartparens)
(package-install-with-refresh 'flycheck)
;; language
(package-install-with-refresh 'rjsx-mode)
(package-install-with-refresh 'web-mode)
(package-install-with-refresh 'fish-mode)
(package-install-with-refresh 'markdown-mode)
(package-install-with-refresh 'python-mode)
(package-install-with-refresh 'yaml-mode)
(package-install-with-refresh 'php-mode)

;;remote
(package-install-with-refresh 'mustache-mode)
(require 'mustache-mode)
(require 'php-mode)

;; delete menu bar
(menu-bar-mode -1)

;; light parentheses
(show-paren-mode 1)
(defun electric-pair ()
  ;; Insert character pair without sournding spaces
  (interactive)
  (let (parens-require-spaces)
    (insert-pair)))

;; "yes or no" -> "y or n"
(fset 'yes-or-no-p 'y-or-n-p)

;; no beep
(defun my-bell-function ()
  (unless (memq this-command
        '(isearch-abort abort-recursive-edit exit-minibuffer
              keyboard-quit mwheel-scroll down up next-line previous-line
              backward-char forward-char))
    (ding)))
(setq ring-bell-function 'my-bell-function)

;; Enable evil
(require 'evil)
(evil-mode 1)
(define-key evil-normal-state-map (kbd "SPC bb") 'helm-mini)
(add-hook 'neotree-mode-hook
	(lambda ()
	    (define-key evil-normal-state-local-map (kbd "l") 'neotree-enter)
	    (define-key evil-normal-state-local-map (kbd "SPC") 'neotree-quick-look)
	    (define-key evil-normal-state-local-map (kbd "q") 'neotree-hide)
	    (define-key evil-normal-state-local-map (kbd "RET") 'neotree-enter)))
(global-set-key [f8] 'neotree-toggle)

;; Enable helm
(require 'helm)
(helm-mode 1)
(define-key evil-normal-state-map (kbd "SPC ff") 'helm-find-files)
;; helm-ag
(setq helm-ag-base-command "rg --vimgrep --no-heading")
(define-key evil-normal-state-map (kbd "SPC ag") 'helm-ag)
;; helm-git-grep
(require 'helm-git-grep)
(global-set-key (kbd "C-c g") 'helm-git-grep)
(define-key isearch-mode-map (kbd "C-c g") 'helm-git-grep-from-isearch)
(eval-after-load 'helm
  '(define-key helm-map (kbd "C-c g") 'helm-git-grep-from-helm))
(package-install-with-refresh 'helm-ag)

;; Enable company-mode
(require 'company)
(global-company-mode)
(setq company-idle-delay 0)
(setq company-minimum-prefix-length 2)
(setq company-selection-wrap-around t)

;; Enable auto-complete
;;(require 'auto-complete-config)
;;(ac-config-default)
;; (add-to-list 'ac-modes 'rjsx-mode)

;; Load other module
(require 'ace-jump-mode)
(define-key evil-normal-state-map (kbd "SPC j") 'ace-jump-word-mode)
(require 'smartparens-config)
(add-hook 'rjsx-mode-hook #'smartparens-mode)
(add-hook 'web-mode-hook #'smartparens-mode)
(add-hook 'emacs-lisp-mode-hook #'smartparens-mode)

;; About rjsx-mode
(add-hook 'rjsx-mode-hook
          (lambda ()
            (setq indent-tabs-mode nil)
            (setq js-indent-level 2)
            (setq js2-strict-missing-semi-warning nil)))

;; About web-mode
(require 'web-mode)
(add-to-list 'auto-mode-alist '("\\.html?\\'" . web-mode))
(add-to-list 'auto-mode-alist '("\\.css?\\'" . web-mode))
;;(add-to-list 'auto-mode-alist '("\\.jsx\\'" . web-mode))

;; custom function
(defun open-emacs-conf ()
  (interactive)
  (find-file "~/.emacs.d/init.el"))

;; Evil KeyBind
(define-key evil-normal-state-map (kbd "SPC vv") 'split-window-horizontally)
(define-key evil-normal-state-map (kbd "SPC hh") 'split-window-vertically)
(define-key evil-normal-state-map (kbd "TAB k") 'evil-window-up)
(define-key evil-normal-state-map (kbd "TAB j") 'evil-window-down)
(define-key evil-normal-state-map (kbd "TAB l") 'evil-window-right)
(define-key evil-normal-state-map (kbd "TAB h") 'evil-window-left)
(define-key evil-normal-state-map (kbd "SPC fed") 'open-emacs-conf)

;; Prettier
(defun my/prettier ()
  (interactive)
  (shell-command
    (format "%s --write %s"
      (shell-quote-argument (executable-find "prettier"))
      (shell-quote-argument (expand-file-name buffer-file-name))))
  (revert-buffer t t t))
(define-key evil-normal-state-map (kbd "SPC cp") 'my/prettier)

;; gtags
(autoload 'gtags-mode "gtags" "" t)
(setq gtags-mode-hook
      '(lambda ()
	 (define-key evil-insert-state-map (kbd "SPC gt") 'gtags-find-tag)
        ))
(add-hook 'php-mode-hook 'helm-gtags-mode)

(custom-set-variables
 ;; custom-set-variables was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 '(custom-safe-themes
   (quote
    ("59171e7f5270c0f8c28721bb96ae56d35f38a0d86da35eab4001aebbd99271a8" default)))
 '(package-selected-packages (quote (evil))))
(custom-set-faces
 ;; custom-set-faces was added by Custom.
 ;; If you edit it by hand, you could mess it up, so be careful.
 ;; Your init file should contain only one such instance.
 ;; If there is more than one, they won't work right.
 )
